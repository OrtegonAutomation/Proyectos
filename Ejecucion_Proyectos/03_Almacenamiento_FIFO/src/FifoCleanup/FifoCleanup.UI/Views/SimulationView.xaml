<UserControl x:Class="FifoCleanup.UI.Views.SimulationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:FifoCleanup.UI.Converters"
             Background="{StaticResource BackgroundBrush}">

    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
        <StackPanel MaxWidth="900">
            <TextBlock Text="SimulaciÃ³n FIFO" Style="{StaticResource HeaderText}"/>
            <TextBlock Text="Genera datos sintÃ©ticos y ejecuta el algoritmo FIFO para validar el comportamiento antes de producciÃ³n."
                       Style="{StaticResource SecondaryText}" Margin="0,0,0,16"/>

            <!-- ParÃ¡metros de simulaciÃ³n -->
            <Border Style="{StaticResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="ParÃ¡metros de Datos SintÃ©ticos" Style="{StaticResource SubHeaderText}" Margin="0,0,0,12"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Margin="0,0,8,12">
                            <TextBlock Text="NÂº de Assets" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding NumberOfAssets, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="4,0,4,12">
                            <TextBlock Text="Variables/Asset" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding VariablesPerAsset, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Margin="4,0,4,12">
                            <TextBlock Text="DÃ­as de historial" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding DaysOfHistory, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="3" Margin="8,0,0,12">
                            <TextBlock Text="TamaÃ±o/dÃ­a (MB)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding AvgDayFolderSizeMB, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,8,0">
                            <TextBlock Text="Disco simulado (GB)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding SimulatedDiskSizeGB, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Grid.Row="1" Margin="4,0,4,0">
                            <TextBlock Text="Uso inicial (%)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding InitialUsagePercent, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Grid.Row="1" Margin="4,0,4,0">
                            <TextBlock Text="Umbral (%)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding ThresholdPercent, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="3" Grid.Row="1" Margin="8,0,0,0">
                            <TextBlock Text="Cap limpieza (%)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding CleanupCapPercent, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="4" Margin="0,8,0,0">
                            <TextBlock Text="Alocar archivo real (MB, opcional)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding AllocateRealBytesMB, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Ruta de simulaciÃ³n y botones -->
            <Border Style="{StaticResource CardPanel}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Ruta de simulaciÃ³n" Style="{StaticResource SecondaryText}"/>
                        <TextBox Text="{Binding SimulationPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,4,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="8,0,0,0">
                        <Button Content="â–¶ Ejecutar SimulaciÃ³n" Style="{StaticResource SuccessButton}"
                                Command="{Binding RunSimulationCommand}"
                                IsEnabled="{Binding IsRunning, Converter={StaticResource BoolToVis}, ConverterParameter=InvertBool}"
                                Margin="0,0,8,0"/>
                        <Button Content="â¹ Cancelar" Style="{StaticResource DangerButton}"
                                Command="{Binding CancelSimulationCommand}"
                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}"/>
                        <Button Content="ðŸ—‘ Limpiar Datos" Style="{StaticResource SecondaryButton}"
                                Command="{Binding CleanupSimulationDataCommand}" Margin="8,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Progreso -->
            <Border Style="{StaticResource CardPanel}"
                    Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}">
                <StackPanel>
                    <TextBlock Text="{Binding ProgressMessage}" Style="{StaticResource BodyText}"/>
                    <ProgressBar Value="{Binding Progress}" Maximum="100" Margin="0,8,0,0" Height="10"/>
                </StackPanel>
            </Border>

            <!-- Resultados -->
            <Border Style="{StaticResource CardPanel}"
                    Visibility="{Binding HasResults, Converter={StaticResource BoolToVis}}">
                <StackPanel>
                    <TextBlock Text="Resultados de la SimulaciÃ³n" Style="{StaticResource SubHeaderText}" Margin="0,0,0,12"/>
                    <TextBlock Text="{Binding ResultSummary}" Style="{StaticResource BodyText}"
                               FontWeight="SemiBold" Margin="0,0,0,12"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Uso Antes" Style="{StaticResource SecondaryText}"/>
                            <TextBlock Text="{Binding UsageBefore}" Style="{StaticResource SubHeaderText}" Foreground="Red"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Uso DespuÃ©s" Style="{StaticResource SecondaryText}"/>
                            <TextBlock Text="{Binding UsageAfter}" Style="{StaticResource SubHeaderText}" Foreground="Green"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Liberado" Style="{StaticResource SecondaryText}"/>
                            <TextBlock Text="{Binding BytesFreed}" Style="{StaticResource SubHeaderText}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="3">
                            <TextBlock Text="Carpetas" Style="{StaticResource SecondaryText}"/>
                            <TextBlock Text="{Binding FoldersDeleted}" Style="{StaticResource SubHeaderText}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="4">
                            <TextBlock Text="DuraciÃ³n" Style="{StaticResource SecondaryText}"/>
                            <TextBlock Text="{Binding Duration}" Style="{StaticResource SubHeaderText}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- SimulaciÃ³n Continua de Ingreso de Datos -->
            <Border Style="{StaticResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="SimulaciÃ³n Continua de Ingreso de Datos" Style="{StaticResource SubHeaderText}" Margin="0,0,0,8"/>
                    <TextBlock Text="Genera datos nuevos periÃ³dicamente para simular el crecimiento realista del almacenamiento y probar RF-07 y RF-08."
                               Style="{StaticResource SecondaryText}" Margin="0,0,0,12"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="0,0,8,0">
                            <TextBlock Text="Tasa de generaciÃ³n (MB por intervalo)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding DataRateMBPerInterval, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="4,0,4,0">
                            <TextBlock Text="Intervalo (segundos)" Style="{StaticResource SecondaryText}"/>
                            <TextBox Text="{Binding IntervalSeconds, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="4,0,8,0">
                            <TextBlock Text="Datos generados" Style="{StaticResource SecondaryText}"/>
                            <TextBlock Text="{Binding ContinuousDataGenerated}" Style="{StaticResource SubHeaderText}" 
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Button Grid.Column="3" VerticalAlignment="Bottom"
                                Command="{Binding ToggleContinuousSimulationCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource SuccessButton}">
                                    <Setter Property="Content" Value="â–¶ Iniciar GeneraciÃ³n"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsContinuousRunning}" Value="True">
                                            <Setter Property="Content" Value="â¹ Detener GeneraciÃ³n"/>
                                            <Setter Property="Background" Value="#DC3545"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>

                    <TextBlock Text="ðŸ’¡ Consejo: Ejecuta primero una simulaciÃ³n inicial, luego inicia RF-07 o RF-08 en la pestaÃ±a EjecuciÃ³n, y finalmente activa la generaciÃ³n continua para ver cÃ³mo responden los servicios al ingreso de datos."
                               Style="{StaticResource SecondaryText}" FontStyle="Italic" Margin="0,12,0,0" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Log de simulaciÃ³n -->
            <Border Style="{StaticResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="Log de SimulaciÃ³n" Style="{StaticResource SubHeaderText}" Margin="0,0,0,8"/>
                    <ListBox ItemsSource="{Binding LogMessages}" MaxHeight="250"
                             FontFamily="Consolas" FontSize="11" Background="#1E1E1E" Foreground="#D4D4D4"
                             BorderThickness="0" Padding="8">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="2"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
