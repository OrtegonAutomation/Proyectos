<UserControl x:Class="FifoCleanup.UI.Views.BitacoraView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:FifoCleanup.UI.Converters"
             Background="{StaticResource BackgroundBrush}">

    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
        <conv:EventTypeToSpanishConverter x:Key="EventToSpanish"/>
        <conv:BytesToSizeConverter x:Key="BytesToSize"/>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TÃ­tulo -->
        <TextBlock Grid.Row="0" Text="BitÃ¡cora de AuditorÃ­a" Style="{StaticResource HeaderText}"/>

        <!-- Filtros -->
        <Border Grid.Row="1" Style="{StaticResource CardPanel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Desde:" VerticalAlignment="Center" Margin="0,0,8,0"
                           Style="{StaticResource SecondaryText}"/>
                <DatePicker Grid.Column="1" SelectedDate="{Binding FilterFrom}" Margin="0,0,12,0"/>

                <TextBlock Grid.Column="2" Text="Hasta:" VerticalAlignment="Center" Margin="0,0,8,0"
                           Style="{StaticResource SecondaryText}"/>
                <DatePicker Grid.Column="3" SelectedDate="{Binding FilterTo}" Margin="0,0,12,0"/>

                <TextBlock Grid.Column="4" Text="Tipo:" VerticalAlignment="Center" Margin="0,0,8,0"
                           Style="{StaticResource SecondaryText}"/>
                <ComboBox Grid.Column="5" ItemsSource="{Binding EventTypes}"
                          SelectedItem="{Binding SelectedEventType}" Margin="0,0,12,0"/>

                <TextBlock Grid.Column="6" Text="Asset:" VerticalAlignment="Center" Margin="0,0,8,0"
                           Style="{StaticResource SecondaryText}"/>
                <TextBox Grid.Column="7" Text="{Binding FilterAssetId, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,12,0"/>

                <Button Grid.Column="8" Content="ðŸ” Buscar" Style="{StaticResource PrimaryButton}"
                        Command="{Binding LoadEntriesCommand}"/>
            </Grid>
        </Border>

        <!-- Tabla de entradas -->
        <Border Grid.Row="2" Style="{StaticResource CardPanel}" Margin="0,0,0,0">
            <DataGrid ItemsSource="{Binding Entries}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Fecha/Hora"
                                        Binding="{Binding Timestamp, StringFormat=dd/MM/yyyy HH:mm:ss}"
                                        Width="140"/>
                    <DataGridTextColumn Header="Tipo"
                                        Binding="{Binding EventType, Converter={StaticResource EventToSpanish}}"
                                        Width="130"/>
                    <DataGridTextColumn Header="AcciÃ³n" Binding="{Binding Action}" Width="160"/>
                    <DataGridTextColumn Header="Asset" Binding="{Binding AssetId}" Width="90"/>
                    <DataGridTextColumn Header="Variable" Binding="{Binding VariableId}" Width="70"/>
                    <DataGridTextColumn Header="Detalles" Binding="{Binding Details}" Width="*"/>
                    <DataGridTextColumn Header="Bytes"
                                        Binding="{Binding BytesAffected, Converter={StaticResource BytesToSize}}"
                                        Width="90"/>
                    <DataGridTextColumn Header="Resultado" Binding="{Binding Result}" Width="80"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Barra inferior -->
        <Grid Grid.Row="3" Margin="0,8,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="{Binding EntryCount}" Style="{StaticResource SecondaryText}"
                       VerticalAlignment="Center"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="ðŸ“¥ Exportar CSV" Style="{StaticResource SecondaryButton}"
                        Command="{Binding ExportCommand}" Margin="0,0,8,0"/>
                <Button Content="ðŸ§¹ Mantenimiento" Style="{StaticResource SecondaryButton}"
                        Command="{Binding MaintenanceCommand}"
                        ToolTip="Elimina registros antiguos segÃºn la retenciÃ³n configurada"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
